<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transformer: Softmax, Temperatura e Random Sampling</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
  <style>
    :root {
      --azul: #8f1818;
      --preto: #111;
      --cinza: #f8f9fa;
    }

    body {
      font-family: 'Segoe UI', Roboto, sans-serif;
      background: white;
      color: var(--preto);
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }

    header {
      background: var(--azul);
      color: white;
      padding: 2rem 1rem;
      text-align: center;
    }

    main {
      max-width: 1000px;
      margin: auto;
      padding: 2rem;
    }

    section {
      background: var(--cinza);
      padding: 1.5rem;
      border-radius: 12px;
      margin-bottom: 2rem;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }

    img {
      display: block;
      max-width: 100%;
      margin: 1rem auto;
      border-radius: 10px;
    }

    .highlight {
      color: var(--azul);
      font-weight: bold;
    }

    .interactive {
      text-align: center;
      margin-top: 2rem;
    }

    button {
      background: var(--azul);
      color: white;
      border: none;
      padding: 0.7rem 1.2rem;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: #01050a;
    }

    .output {
      margin-top: 1rem;
      font-size: 1.2rem;
      font-weight: bold;
    }

    footer {
      text-align: center;
      padding: 2rem 1rem;
      border-top: 1px solid #ddd;
      color: #444;
    }

    a {
      color: var(--azul);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

<header>
  <h1>Transformer: Softmax, Temperatura e Random Sampling</h1>
  <p>Visualiza√ß√£o e explica√ß√£o completa do processo interno de gera√ß√£o de texto</p>
</header>

<main>
  <section>
    <h2>1. Input Vocab e Logits</h2>
    <p>
      A coluna <strong>Vocab (V)</strong> mostra as palavras candidatas: <code>who, where, why, what, how</code>.<br>
      A coluna <strong>Logit (Z)</strong> mostra o valor cru de ativa√ß√£o que o modelo gera antes de converter em probabilidades.<br>
      Por exemplo: <em>why</em> tem o maior logit (5,20), ent√£o tende a ser mais prov√°vel.
    </p>
  </section>

  <section>
    <h2>2. Temperatura (T)</h2>
    <p>
      A <span class="highlight">temperatura</span> controla a aleatoriedade.
      Temperaturas baixas (T < 1) tornam o modelo mais ‚Äúdecidido‚Äù: amplificam as diferen√ßas entre logits.<br>
      Temperaturas altas (T > 1) tornam o modelo mais ‚Äúcriativo‚Äù: achatam as diferen√ßas e aproximam as probabilidades.
    </p>
    <p>Matematicamente, cada logit √© dividido pela temperatura: Z' = Z / T</p>
    <p>Exemplo com T = 2.9:</p>
    <ul>
      <li>why ‚Üí 0.41</li>
      <li>what ‚Üí 0.20</li>
      <li>who ‚Üí 0.16</li>
      <li>how ‚Üí 0.14</li>
      <li>where ‚Üí 0.10</li>
    </ul>
  </section>

  <section>
    <h2>3. Softmax</h2>
    <p>
      A fun√ß√£o <span class="highlight">Softmax</span> converte os valores ajustados (logits) em probabilidades normalizadas:
      <br>\(P_i = e^{Z_i/T} / \sum e^{Z_j/T}\)
      <br>Assim, todas as probabilidades somam 1.0.
    </p>
  </section>

  <section>
    <h2>4. Random Number (r)</h2>
    <p>
      O modelo gera um n√∫mero aleat√≥rio entre 0 e 1 (<code>r</code>) e verifica em qual faixa cumulativa o n√∫mero cai.
      Por exemplo:
    </p>
    <table>
      <tr><th>Palavra</th><th>Faixa</th></tr>
      <tr><td>why</td><td>0,00 ‚Äì 0,41</td></tr>
      <tr><td>what</td><td>0,41 ‚Äì 0,61</td></tr>
      <tr><td>who</td><td>0,61 ‚Äì 0,77</td></tr>
      <tr><td>how</td><td>0,77 ‚Äì 0,91</td></tr>
      <tr><td>where</td><td>0,91 ‚Äì 1,00</td></tr>
    </table>
    <p>
      Se o n√∫mero <code>r = 0.5</code>, a palavra escolhida ser√° <strong>‚Äúwhat‚Äù</strong>.<br>
      Cada execu√ß√£o gera um novo n√∫mero aleat√≥rio ‚Äî e, portanto, resultados diferentes respeitando as probabilidades.
    </p>
  </section>

  <section>
    <h2>5. O papel do Random no algoritmo</h2>
    <p>
      No ciclo interno de gera√ß√£o do modelo, o n√∫mero aleat√≥rio √© sempre gerado para cada token.<br>
      O processo √©: <br>
      <strong>Softmax ‚Üí Random ‚Üí Escolha ‚Üí Pr√≥ximo token ‚Üí Recalcula tudo</strong>.
    </p>
    <p>
      Esse sorteio ponderado √© o que faz o texto parecer humano e imprevis√≠vel.<br>
      Sem ele, o modelo seria totalmente determin√≠stico e repetitivo.
    </p>
  </section>

  <section>
    <h2>6. Ciclo Auto-Regressivo</h2>
    <p>
      Cada token escolhido √© realimentado no modelo, que calcula novos logits e reinicia o processo.
    </p>
  </section>

  <section class="interactive">
    <h2>Experimente o sorteio de palavras</h2>
    <p>Clique no bot√£o para simular o ‚Äúrandom sampling‚Äù:</p>
    <button onclick="generateWord()">Sortear Palavra</button>
    <div class="output" id="output"></div>
  </section>
</main>

<footer>
  <p>
    üîó Leia o artigo original:
    <a href="https://arxiv.org/abs/1706.03762" target="_blank">
      Attention Is All You Need (Vaswani et al., 2017)
    </a><br>
    üîó Download da planilha:
    <a href="https://github.com/aasouzaconsult/engenharia_prompt/blob/main/Temperature.xlsx" target="_blank">
      Temperature
    </a>
  </p>
</footer>

<script>
function generateWord() {
  const words = [
    { word: "why", prob: 0.41 },
    { word: "what", prob: 0.20 },
    { word: "who", prob: 0.16 },
    { word: "how", prob: 0.14 },
    { word: "where", prob: 0.10 }
  ];

  const r = Math.random();
  let cumulative = 0;
  let selected = "";

  for (const w of words) {
    cumulative += w.prob;
    if (r <= cumulative) {
      selected = w.word;
      break;
    }
  }

  document.getElementById("output").innerHTML = 
    `N√∫mero aleat√≥rio: <span class='highlight'>${r.toFixed(2)}</span><br>` +
    `Palavra sorteada: <span class='highlight'>${selected}</span>`;
}
</script>

</body>
</html>
